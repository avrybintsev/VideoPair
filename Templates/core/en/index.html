<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>VideoPair</title>
    <link href="{{ STATIC_URL }}css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ STATIC_URL }}css/index.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="{{ STATIC_URL }}js/jquery-1.11.1.min.js"></script>
    <script src="{{ STATIC_URL }}js/jquery.form.min.js"></script>
    <script src="{{ STATIC_URL }}js/bootstrap.min.js"></script>
    <script src="{{ STATIC_URL }}js/popcorn.min.js"></script>
</head>

<body>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                {% if participant %}
                    <span class="icon-bar"></span>
                {% endif %}
            </button>
            <a class="navbar-brand" href="{% url 'core.views.index' lang %}">VideoPair</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                {% if participant %}
                    <li><a href="{% url 'core.views.invalidate' 'en' %}">Logout ({{ participant }})</a></li>
                {% endif %}
                <li><a href="{% url 'core.views.index' 'ru' %}">Russian version</a></li>
            </ul>
        </div>
    </div>
</div>

{% if not participant %}
    <div class="container container-login">
        <div class="login-panel panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Video comparison</h3>
            </div>
            <div class="panel-body">
                <form class="form-signin" role="form" method="post" action="/en/new">
                    {% csrf_token %}
                    <fieldset>
                        <div class="form-group">
                            <input class="form-control" placeholder="E-mail" id="id_email" name="email" type="email"
                                   autofocus="">
                        </div>
                        <div class="form-group">
                            <input class="form-control" placeholder="Имя" id="id_name" name="name" type="name" value="">
                        </div>
                        <div class="form-button-container">
                            <button class="btn btn-lg btn-success" type="submit">Begin test</button>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
{% elif forms|length > 0 %}
    <div class="container">
        <div class="finish-block" id="finish-block">
            <p>{{ participant.name }}, you've answered all questions</p>
        </div>

        <div class="loader-block" id="loader-block">
            <div class="info-block">
                <p class="lead">VideoPair - video comparison</p>
                <p>
                    Some information
                </p>
            </div>
            <div class="progress-block" id="progress-block">
                <div class="progress-text">
                    Loading videos: <span id="progress-current">0</span> of <span id="progress-total">20</span>
                </div>
                <div class="progress">
                    <div id="progress" class="progress-bar" role="progressbar"
                         aria-valuenow="0" aria-valuemin="0" aria-valuemax="20" style="width: 0%;">
                    </div>
                </div>
            </div>
            <div class="begin-block" id="begin-block">
                 <button class="btn btn-lg btn-primary" id="begin-button">
                     Begin test
                 </button>
            </div>
        </div>

        {% for form in forms %}
            <div class="question-block" id="question{{ forloop.counter0 }}">
                <div class="container">
                    <div class="header header-line">
                        <h3>Video comparison</h3>
                        <p class="lead lead-smallmargin">Question #<span id="counter{{ forloop.counter0 }}">{{ forloop.counter }}</span> of {{ forms|length }}</p>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <video id="player-video-left{{ forloop.counter0 }}" loop poster="{{ STATIC_URL }}img/poster.gif"></video>
                        </div>
                        <div class="col-md-6">
                            <video id="player-video-right{{ forloop.counter0 }}" loop poster="{{ STATIC_URL }}img/poster.gif"></video>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 clearfix">
                            <form method="post" action="/ans" id="form-left{{ forloop.counter0 }}" class="answer-form">
                                {% csrf_token %}
                                {{ form.answer_left_form }}
                                <button id="best-left{{ forloop.counter0 }}" type="submit" class="btn btn-lg btn-primary pull-left">
                                    Left is better
                                </button>
                            </form>
                        </div>
                        <div class="col-md-6 clearfix">
                            <form method="post" action="/ans" id="form-right{{ forloop.counter0 }}" class="answer-form">
                                {% csrf_token %}
                                {{ form.answer_right_form }}
                                <button id="best-right{{ forloop.counter0 }}" type="submit" class="btn btn-lg btn-primary pull-right">
                                    Right is better
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 none-form">
                            <form method="post" action="/ans" id="form-none{{ forloop.counter0 }}" class="answer-form">
                                {% csrf_token %}
                                {{ form.answer_none_form }}
                                <button id="best-none{{ forloop.counter0 }}" type="submit" class="btn btn-lg btn-default">
                                    None is better
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

    <script>
        var total = {{ forms|length }};
    </script>
    <script src="{{ STATIC_URL }}js/index.js"></script>
    <script>
        update_progress();
        {% for form in forms %}
            load_video(
                    videos_el[{{ forloop.counter0 }}].left,
                    "{{ video_path }}/{{ form.question.sequence.name }}/{{ form.question.left.short_name }}.mp4",
                    "{{ video_path }}/{{ form.question.sequence.name }}/{{ form.question.left.short_name }}.webm"
            );
            load_video(
                    videos_el[{{ forloop.counter0 }}].right,
                    "{{ video_path }}/{{ form.question.sequence.name }}/{{ form.question.right.short_name }}.mp4",
                    "{{ video_path }}/{{ form.question.sequence.name }}/{{ form.question.right.short_name }}.webm"
            );
        {% endfor %}
    </script>
{% else %}
    <div class="container">
        <div>
            <p>{{ participant.name }}, you've answered all questions!</p>
        </div>
    </div>
{% endif %}

</body>
</html>